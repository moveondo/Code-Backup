

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>曹操贷最快10分钟放款</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="//m.ppdaicdn.com/act/caocao/css/swiper.min.css">
    <link rel="stylesheet" type="text/css" href="//m.ppdaicdn.com/act/cpa/css/reset.css">
    <link rel="stylesheet" type="text/css" href="//m.ppdaicdn.com/act/cpa/css/style.css">
    <script type="text/javascript">
        (function (d, s, i) {
        var f = d.getElementsByTagName(s)[0],j = d.createElement(s);
        j.async = true; j.src ='//ubt.ppdaicdn.com/ppubt.js?Landing=true&appid=' + i ;
        f.parentNode.insertBefore(j, f);
        })(document, 'script', '1');
    </script>
</head>
<body>
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide slide1" style="padding-bottom:20px;">
                <img src="//m.ppdaicdn.com/act/cpa/img/banner.png" class="banner">
                <img src="//m.ppdaicdn.com/act/cpa/img/text.png" class="text">
                <div class="num"><span id="amount" class="amount">3,152,672,400</span>元</div>
                <div class='phone'>
                    <label>手机号</label>
                    <input type="tel" maxLength="11" placeholder="请输入常用手机号" name="phoneNum" class="phoneNum" id="num1"/>
                </div>
                <a class="downLoad" id="btn1">
                    <img src="//m.ppdaicdn.com/act/cpa/img/btn.png" class="btn">
                </a>
                <img class="btn-slide" src="//m.ppdaicdn.com/act/cpa/img/slide.png">
            </div>
            <div class="swiper-slide slide2">
                <img src="//m.ppdaicdn.com/act/cpa/img/center.png" class="center">
                <img src="//m.ppdaicdn.com/act/cpa/img/usersay.png" class="usersay">
                <div class="cmmtArea">
                    <div class="cmmtCont">
                        <img src="//m.ppdaicdn.com/act/cpa/img/cmt1.png">
                        <img src="//m.ppdaicdn.com/act/cpa/img/cmt2.png">
                    </div>
                </div>
            </div>
            <div class="swiper-slide slide3">
                <div class="cmmtArea">
                    <div class="cmmtCont">
                        <img src="//m.ppdaicdn.com/act/cpa/img/cmt3.png">
                        <img src="//m.ppdaicdn.com/act/cpa/img/cmt4.png">
                        <img src="//m.ppdaicdn.com/act/cpa/img/cmt5.png" style="border-bottom:none;">
                    </div>
                </div>
                <img src="//m.ppdaicdn.com/act/cpa/img/tel.png" class="tel">
            </div>
        </div>
        <div class="swiper-pagination"></div>
    </div>
    <footer>
        <div class="mask"></div>
        <div class="ftCont">
            <div class='phone'>
                <label>手机号</label>
                <input type="tel" maxLength="11" placeholder="请输入常用手机号" name="mobile" class="phoneNum" id="num2"/>
            </div>
            <a class="downLoad" id="btn2">
                <img src="//m.ppdaicdn.com/act/cpa/img/btn.png" class="btn">
            </a>
        </div>
    </footer>
	<div class="pop"></div>
    <div class="toast1">
        <p>客官，您的手机已经注册了拍拍贷，可直接登录曹操贷。</p>
        <p>曹操贷是拍拍贷旗下产品，账号通用哦！</p>
        <div class="sureBtn">确定</div>
    </div>
     <div class="toast2">
        <p>客官，您的手机已经注册，请下载曹操贷APP直接登录！</p>
        <div class="sureBtn">确定</div>
    </div>
    <script src="//m.ppdaicdn.com/act/cpa/js/jquery.min.js"></script>
    <script src="//m.ppdaicdn.com/act/cpa/js/swiper.min.js"></script>
    <script>

     //获取渠道参数；
    var flag;
    var mob1;
    var _src = GetQueryString("source");
        _src = !_src ? "" : _src;
    var _ckey = GetQueryString("ckey");
        _ckey = !_ckey ? "" : _ckey;
    var channel = 'CPA',
        uType,
        refId;
    //获取页面url参数；
    function GetQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i");
        var r = window.location.search.substr(1).match(reg);
        if (r!=null) return (r[2]); return null;
    }
    var  isWeiXin = function() {
        var ua = window.navigator.userAgent.toLowerCase();
        if (ua.match(/MicroMessenger/i) == 'micromessenger') {
            return true;
        } else {
            return false;
        }
    }
    var isWx       = isWeiXin(),
        isiOS      = navigator.userAgent.match('iPad')
                     || navigator.userAgent.match('iPhone')
                     || navigator.userAgent.match('iPod'),
         dlurl =  GetQueryString("url"),
         iosURL     = !dlurl ? "https://itunes.apple.com/cn/app/id1104239394" : dlurl,
        isAndroid  = navigator.userAgent.match('Android');
	var _tp = isiOS ? 0 : 1;
    var os = isiOS ? "ios" : "Android";
   var downLoad= function(){
            if (isWx) {
                window.location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.ppdai.loan.caocao&ckey="+_ckey;
            }else if(isiOS){
                window.location.href=iosURL;
            }else{
                var Url = "//m.ppdai.com/Down/CaoCaoLoan/"+_src;
                window.location.href=Url;
            }
        };

    var saveRecord = function(userType){
        if(userType.IsNewUser){uType=1}else if(userType.IsCaoCaoUser){uType=2}else{uType=3}
        var url = '//mobiccdai.ppdai.com/ccdai/api/distribute/saveDownloadRecordForDownload.htm';
        var datas = {
            mobile:mob1,
            channel:channel,
            subChannel:_src,
            os:os,
            sendMsg:false,
            userType:uType,
        }
        $.ajax({
            type:'get',
            url:url,
            data:datas,
            dataType:'jsonp',
            success:function(data){
                var data =$.parseJSON(data);
                if(data.result == 0){
                    refId = data.id;
                    if(uType==1){
                        //新用户
                        window.location.href="register.html?phoneNum="+mob1+"&source="+_src;
                    }else if(uType==2){
                        //是曹操贷用户，提示
                        $('.pop').show();
                        $('.toast2').show();
                    }else{
                        //拍拍贷用户
                        $('.pop').show();
                        $('.toast1').show();
                    }
                }
            },
            error: function(){
                alert("网络错误");
            }
        })
    }

    var confirmDownload = function(){
        var url = '//mobiccdai.ppdai.com/ccdai/api/distribute/confirmDownload.htm';
        $.ajax({
            type:'get',
            url:url,
            data:{refId:refId},
            dataType:'jsonp',
            success:function(data){
            },
            error: function(){
                //alert("网络错误");

            }
        })
    }

    //点击传值并下载；
   $('#btn1,#btn2').on('click',function(){
        mob1 = $.trim($(this).prev().find('input').val());
        if(mob1.length<1){
            $(this).prev().find('input').attr('placeholder','请先输入手机号~').addClass('redPlhd');
            return;
        }else if(!/^(13|14|15|17|18)[0-9]{9}$/.test(mob1)){
            $(this).prev().find('input').val('').attr('placeholder','请输入正确的手机号~');
            return;
        }
        flag=false;
        $.ajax({
                type :'get',
                async: false,
                url  : "//m.ppdai.com/Activity/CaoCaoCpa",
                data : {mobile:mob1,source:_src,type:_tp},
                success: function(data){
                    if(data.IsSuccess){
                        saveRecord(data.Result);
                    }
                },
                error: function(XMLHttpRequest, textStatus, errorThrown){
                    alert("网络错误")
                }
            })
         flag=true;
    })
    $('.sureBtn').on('click',function(){
        $(this).parent().hide();
        $('.pop').hide();
        downLoad();
    })
     //统计点击次数；
    var accountClickNum = function(_html,txt){
        var _url = "//m.ppdai.com/loan/Users/ActionLog";
        var actionId = GetQueryString('aId');
           if (!actionId) {
               actionId = 210;
           }
        $.ajax({
            async: false,
            url: _url,
            data: {
                FunctionName : _html,
                ActionId : actionId,
                Remark : txt,
                Parameter:mob1
            },
            type: "GET",
            dataType: 'json',
            success: function(data) {
                //console.log(data)
            }
        })
    }
    $('.sureBtn').on('click',function(){
        accountClickNum('APP下载点击量','点击数');
        confirmDownload();
    })
    //轮播及弹窗显示效果
    var t;
    var mySwiper = new Swiper('.swiper-container', {
        pagination: '.swiper-pagination',
        paginationClickable: true,
        mousewheelControl : true,
        direction: 'vertical',
        moveStartThreshold:100,
        loop:false,
        onSlideChangeStart:function(swiper){
                if(!flag){
                    clearTimeout(t);
                    var idx = swiper.activeIndex;
                    $('footer').hide();
                    if(idx == 1){
                        t=setTimeout("$('footer').show()",1000);
                    }else if(idx == 2){
                        $('footer').show();
                    }
                }
            }

    });
    //数字累加效果
    var currentNum = parseInt($("#amount").html().replace(/\,/g,''));
    setInterval("jump()",1500);
    function jump(){
        currentNum += 400;
        $("#amount").html(thousands(currentNum));
    }
    //千位分隔符；
    function thousands(num){
            num = num.toString();
            if(/^-?\d+\.?\d+$/.test(num)){
                if(/^-?\d+$/.test(num)){
                    num =num + ",00";
                }else{
                    num = num.replace(/\./,',');
                }
                while(/\d{4}/.test(num)){
                    num = num.replace(/(\d+)(\d{3}\,)/,'$1,$2');
                }
                num = num.replace(/\,(\d*)$/,'');
            }
            return num;
        }

    </script>
</body>
</html>
